{% extends 'base.html' %}
{% load static %}
{% load template_tags %}
{% load crispy_forms_tags %}

{% block title_page %}
{{title_page}}
{% endblock title_page %}

{% block css %}

{% endblock css %}

{% block navigation %}

{% endblock navigation %}

{% block content %}

    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="d-flex flex-row justify-content-between">
                    <div class="d-flex flex-row mb-1">
                        <div>
                            <a href="{{url}}"><i class="fas fa-chevron-left mr-3 pt-1" style="font-size:x-large;"></i></a>
                        </div>
                        <p class="h4">{{title}}</p>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    {{ form.media }}
                    <div class="col-md-12">
                        <div class="form-group row">
                            <label class="col-md-3">Nama</label>
                            <div class="col-md-9">{{object.pegawai}}</div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-3">Kegiatan Presensi</label>
                            <div class="col-md-9">{{object.kegiatan}}</div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            {{ form|crispy }}
                            {{ formset.management_form }}

                            <table id="formset" class="form table">
                                {% for form in formset.forms %}
                                    {% if forloop.first %}
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                {% for field in form.visible_fields %}
                                                    {% if field.name != 'DELETE' %}
                                                        <th>{{ field.label|capfirst }}</th>
                                                    {% endif %}
                                                {% endfor %}
                                                {% if form.instance.pk %}
                                                    <th>Hapus?</th>
                                                {% else %}
                                                    <th></th>
                                                {% endif %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                    {% endif %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        {% for field in form.visible_fields %}
                                            {% if field.name != 'DELETE' %}
                                                <td>
                                                    {% if forloop.first %}
                                                        {% for hidden in form.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {{ field.errors.as_ul }}
                                                    {{ field }}
                                                </td>
                                            {% endif %}
                                        {% endfor %}

                                        {# Only show delete checkbox for existing instances #}
                                        {% if form.instance.pk %}
                                            <td>{{ form.DELETE }}</td>
                                        {% else %}
                                            <td></td>
                                        {% endif %}
                                    </tr>
                                    {% if forloop.last %}
                                        </tbody>
                                    {% endif %}
                                {% endfor %}
                            </table>

                            <div style="display: flex; justify-content:flex-end;">
                                <button class="btn btn-primary" style="margin-right: 10px;" type="submit">Simpan</button>
                                <button class="btn btn-danger" style="margin-right: 10px;" type="button" onclick="window.location.href='{{url}}'">Batal</button>
                            </div>

                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>


{% endblock %}



{% block script %}
<script>
    $(document).ready(function () {
        $('#data_table').DataTable({
            dom: 'Blfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf'
            ],
            lengthMenu: [
                [10, 25, 50, -1],
                [10, 25, 50, 'All'],
            ],
        });
    });

    $(document).ready(function() {
        $('.sdm').select2();
        selectOnClose: true
    });
</script>

<script>
    $(document).ready(function(){
        $('.pegawai').hide();
        $('.select2').select2();
    });
</script>

{% endblock script %}