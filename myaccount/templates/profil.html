{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title_page %}
    
{% endblock title_page %}

{% block content %}
    <!-- Default box -->
<div class="card card-solid">
    <div class="card-body pb-0">
        <div class="row">
            <div class="col-12 d-flex align-items-stretch flex-column">
                <div class="card bg-light d-flex flex-fill">
                    <div class="card-header text-muted">
                       <h4>Profil Users</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table" id="data_table">
                                        <thead>
                                            <tr>
                                                <th>Nama</th>
                                                <th>NIP</th>
						                        <th>Penempatan</th>
                                                <th>TTL</th>
                                                <th>No Telp</th>
                                                <th>Email</th>
                                                <th>Alamat</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in object_list %}
                                            <tr>
                                                <td>{{item.full_name}}</td>
                                                <td>{{item.profil_user.nip}}</td>
                                                <td>
                                                {% for item2 in item.riwayatpenempatan_set.all %}
                                                    {% if item2.status and item2.penempatan_level4 %}
                                                    {{item2.penempatan_level4}}
                                                    {% elif item2.status and item2.penempatan_level3 %}
                                                    {{item2.penempatan_level3}}
                                                    {% elif item2.status and item2.penempatan_level2 %}
                                                    {{item2.penempatan_level2}}
                                                    {% elif item2.status and item2.penempatan_level1 %}
                                                    {{item2.penempatan_level1}}
                                                    {% endif %}
                                                {% endfor %}
                                                </td>
                                                <td>{{item.profil_user.tmp_lahir}}, {{item.profil_user.tgl_lahir|date:'d F Y'}}</td>
                                                <td>{{item.profil_user.no_hp}}</td>
                                                <td>{{item.profil_user.email_pribadi}}</td>
                                                <td>{{item.profil_user.alamat}}</td>
                                                <td>
                                                    <a class="btn btn-outline-info" href="{% url 'myaccount_urls:profil_update_view' pk=item.pk %}"><i class="fas fa-edit"></i></a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block script %}
<script>
    $(document).ready(function () {
        $('#data_table').DataTable({
            dom: 'Blfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf'
            ],
            lengthMenu: [
                [10, 25, 50, -1],
                [10, 25, 50, 'All'],
            ],
        });
    });
</script>
    <script>
        const btn = document.getElementById('btn_profil');
        
        btn.addEventListener('click', () => {
        const form = document.getElementById('form_profil');
        const data = document.getElementById('data_profil');

        if (form.style.display === 'none' && data.style.display === 'block') {
            // üëáÔ∏è this SHOWS the form
            form.style.display = 'block';
            data.style.display = 'none';
            btn.value="Lihat Profil"
          } else {
            // üëáÔ∏è this HIDES the form
            form.style.display = 'none';
            data.style.display = 'block';
            btn.value="Update Profil"
          }
});
    </script>
{% endblock script %}
